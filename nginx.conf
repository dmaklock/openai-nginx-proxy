server {
    listen 3000;
    server_name localhost;

    # Увеличиваем размер буферов для больших запросов
    client_max_body_size 50M;
    client_body_buffer_size 128k;

    # Таймауты для длинных запросов (chat completions могут быть долгими)
    proxy_connect_timeout 300s;
    proxy_send_timeout 300s;
    proxy_read_timeout 300s;
    send_timeout 300s;

    # Проксирование всех запросов к OpenAI API
    location / {
        proxy_pass  https://api.openai.com/;  # 反向代理到https://api.openai.com/这个地址
        proxy_ssl_server_name on;  # 开启代理SSL服务器名称验证，确保SSL连接的安全性
        proxy_set_header Host api.openai.com;  # 设置代理请求头中的Host字段为api.openai.com
        chunked_transfer_encoding off;  # 禁用分块编码传输，避免可能的代理问题
        proxy_buffering off;  # 禁用代理缓存，避免数据传输延迟
        proxy_cache off;  # 禁用代理缓存，确保实时获取最新的数据
        #proxy_set_header X-Forwarded-For $remote_addr;  # 将客户端真实IP添加到代理请求头中的X-Forwarded-For字段中，用于记录客户端真实IP
    }
}

